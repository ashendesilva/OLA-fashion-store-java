<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>OLA Fashion Store - Forgot Password</title>
        <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet" />
        <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet" />
        <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
        <style>
            body {
                background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
                min-height: 100vh;
                font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
            }
            .auth-container {
                min-height: 100vh;
                display: flex;
                align-items: center;
                justify-content: center;
                padding: 20px;
            }
            .auth-card {
                background: #fff;
                border-radius: 20px;
                box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
                overflow: hidden;
                max-width: 980px;
                width: 100%;
            }
            .image-section {
                background: linear-gradient(45deg, #667eea 0%, #764ba2 100%);
                min-height: 620px;
                background-image: url('images/slide-03.jpg');
                background-repeat: no-repeat;
                background-size: cover;
                background-position: center center;
                position: relative;
            }
            .form-section {
                padding: 60px 40px;
                display: flex;
                flex-direction: column;
                justify-content: center;
            }
            .brand-title {
                font-size: 2.2rem;
                font-weight: 800;
                color: #333;
                margin-bottom: 6px;
            }
            .subtitle {
                color: #666;
                font-size: 1.05rem;
                margin-bottom: 28px;
            }
            .help-text {
                color: #666;
                line-height: 1.6;
                margin-bottom: 24px;
            }
            .btn-primary {
                background: #007bff;
                border: none;
                font-weight: 600;
                border-radius: 12px;
                padding: 12px 16px;
                transition: all 0.25s ease;
            }
            .btn-primary:hover {
                background: #0056b3;
                transform: translateY(-1px);
                box-shadow: 0 8px 18px rgba(0, 123, 255, 0.25);
            }
            .btn-outline-secondary {
                border-radius: 12px;
            }
            .form-control {
                border: 2px solid #e1e5e9;
                background: #f8f9fa;
                border-radius: 12px;
                padding: 12px 14px;
            }
            .form-control:focus {
                background: #fff;
                border-color: #007bff;
                box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.12);
            }
            .alert-soft {
                border: 0;
                border-radius: 12px;
            }
            .code-inputs {
                display: grid;
                grid-template-columns: repeat(6, 1fr);
                gap: 10px;
            }
            .code-inputs input {
                text-align: center;
                font-size: 1.25rem;
                font-weight: 700;
                height: 54px;
            }
            .meter {
                height: 8px;
                border-radius: 999px;
                background: #e9ecef;
                overflow: hidden;
            }
            .meter > span {
                display: block;
                height: 100%;
                width: 0%;
                transition: width 0.25s ease;
            }
            .meter.weak > span {
                background: #dc3545;
            }
            .meter.fair > span {
                background: #fd7e14;
            }
            .meter.good > span {
                background: #ffc107;
            }
            .meter.strong > span {
                background: #28a745;
            }

            .link-muted {
                color: #6c757d;
                text-decoration: none;
            }
            .link-muted:hover {
                text-decoration: underline;
            }

            @media (max-width: 992px) {
                .image-section {
                    min-height: 220px;
                }
                .form-section {
                    padding: 36px 24px;
                }
            }
        </style>
    </head>
    <body>
        <div class="auth-container">
            <div class="auth-card row g-0">
                <!-- Image -->
                <div class="col-lg-6 d-none d-lg-block">
                    <div class="image-section"></div>
                </div>

                <!-- Form -->
                <div class="col-lg-6">
                    <div class="form-section">
                        <h1 class="brand-title">Forgot Password</h1>
                        <p class="subtitle"><span class="text-primary fw-bold">OLA</span> Fashion Store</p>

                        <div id="step-email">
                            <p class="help-text">Enter your account email and we'll send a 6‑digit reset code.</p>
                            <div class="mb-3">
                                <label for="email" class="form-label">Email address</label>
                                <div class="input-group">
                                    <span class="input-group-text bg-light"><i class="fa-solid fa-envelope"></i></span>
                                    <input type="email" class="form-control" id="email" placeholder="you@example.com" autocomplete="email" required />
                                </div>
                                <div class="form-text">Make sure you have access to this inbox.</div>
                            </div>
                            <button id="sendCodeBtn" class="btn btn-primary w-100" onclick="forgotPassword();">
                                <i class="fa-solid fa-paper-plane me-2"></i> Send Reset Code
                            </button>
                        </div>

                        <div id="step-code" class="d-none">
                            <!--                            <div class="alert alert-info alert-soft mb-3">
                                                            <i class="fa-solid fa-circle-info me-2"></i>
                                                            We emailed a 6‑digit code to <span id="emailPreview" class="fw-semibold"></span>.
                                                        </div>-->

                            <label class="form-label">New Passowrd</label>
                            <div class="input-group mb-4">
                                <input type="password" class="form-control form-control-lg bg-light fs-6" id="newPassword">
                            </div>

                            <label class="form-label">Confirm Password</label>
                            <div class="input-group mb-4">
                                <input type="password" class="form-control form-control-lg bg-light fs-6" id="confirmPassword">
                            </div>

                            <label class="form-label">Verification Code</label>
                            <div class="input-group mb-4">
                                <input type="text" class="form-control form-control-lg bg-light fs-6" placeholder="Verification Code" id="verificationCode">
                            </div>


                            <div class="d-grid gap-2">
                                <button id="verifyCodeBtn" class="btn btn-primary" onclick="verifyCode();">
                                    <i class="fa-solid fa-check-circle me-2"></i> Reset Password
                                </button>

                            </div>
                        </div>

                        <div id="step-reset" class="d-none">
                            <div class="alert alert-success alert-soft mb-3">
                                <i class="fa-solid fa-shield-check me-2"></i>
                                Code verified. Set a new password.
                            </div>

                            <div class="mb-3">
                                <label for="password" class="form-label">New password</label>
                                <div class="input-group">
                                    <span class="input-group-text bg-light"><i class="fa-solid fa-lock"></i></span>
                                    <input type="password" class="form-control" id="password" placeholder="••••••••" autocomplete="new-password" required />
                                    <button class="btn btn-outline-secondary" type="button" id="togglePass"><i class="fa-regular fa-eye"></i></button>
                                </div>
                                <div class="meter mt-2" id="strengthMeter"><span></span></div>
                                <div class="form-text" id="strengthText">Use 8+ chars with letters, numbers & symbols.</div>
                            </div>

                            <div class="mb-3">
                                <label for="confirm" class="form-label">Confirm password</label>
                                <div class="input-group">
                                    <span class="input-group-text bg-light"><i class="fa-solid fa-lock"></i></span>
                                    <input type="password" class="form-control" id="confirm" placeholder="••••••••" autocomplete="new-password" required />
                                </div>
                                <div class="invalid-feedback d-block d-none" id="matchError">Passwords don't match.</div>
                            </div>

                            <button id="resetBtn" class="btn btn-primary w-100" disabled>
                                <i class="fa-solid fa-rotate me-2"></i> Reset Password
                            </button>
                        </div>

                        <div class="text-center mt-4">
                            <a href="sign-in.html" class="link-muted">Back to sign in</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
        <script src="js/forgot-password.js"></script>

        <script>
                                    // --- Helpers ---
                                    const $ = (sel) => document.querySelector(sel);
                                    const $$ = (sel) => Array.from(document.querySelectorAll(sel));

                                    const stepEmail = $('#step-email');
                                    const stepCode = $('#step-code');
                                    const stepReset = $('#step-reset');

                                    const emailInput = $('#email');
                                    const emailPreview = $('#emailPreview');
                                    const sendCodeBtn = $('#sendCodeBtn');

                                    const codeInputsWrapper = $('#codeInputs');
                                    const verifyCodeBtn = $('#verifyCodeBtn');
                                    const editEmailBtn = $('#editEmailBtn');
                                    const resendLink = $('#resendLink');
                                    const timerEl = $('#timer');

                                    const password = $('#password');
                                    const confirmPw = $('#confirm');
                                    const togglePass = $('#togglePass');
                                    const strengthMeter = $('#strengthMeter');
                                    const strengthBar = strengthMeter.querySelector('span');
                                    const strengthText = $('#strengthText');
                                    const matchError = $('#matchError');
                                    const resetBtn = $('#resetBtn');



                                    function toStep(step) {
                                        stepEmail.classList.toggle('d-none', step !== 'email');
                                        stepCode.classList.toggle('d-none', step !== 'code');
                                        stepReset.classList.toggle('d-none', step !== 'reset');
                                    }

                                    // --- Step 2: verify code ---
                                    function buildCodeInputs() {
                                        codeInputsWrapper.innerHTML = '';
                                        for (let i = 0; i < 6; i++) {
                                            const input = document.createElement('input');
                                            input.type = 'text';
                                            input.inputMode = 'numeric';
                                            input.pattern = '[0-9]*';
                                            input.maxLength = 1;
                                            input.className = 'form-control';
                                            codeInputsWrapper.appendChild(input);
                                        }
                                        const inputs = $$('#codeInputs input');
                                        inputs[0].focus();

                                        inputs.forEach((el, idx) => {
                                            el.addEventListener('input', (e) => {
                                                e.target.value = e.target.value.replace(/\D/g, '');
                                                if (e.target.value && idx < inputs.length - 1)
                                                    inputs[idx + 1].focus();
                                                verifyCodeBtn.disabled = inputs.some((i) => !i.value);
                                            });
                                            el.addEventListener('keydown', (e) => {
                                                if (e.key === 'Backspace' && !e.target.value && idx > 0) {
                                                    inputs[idx - 1].focus();
                                                    inputs[idx - 1].value = '';
                                                }
                                            });
                                            el.addEventListener('paste', (e) => {
                                                e.preventDefault();
                                                const data = (e.clipboardData || window.clipboardData).getData('text').replace(/\D/g, '').slice(0, 6);
                                                data.split('').forEach((char, i) => {
                                                    if (inputs[i])
                                                        inputs[i].value = char;
                                                });
                                                verifyCodeBtn.disabled = inputs.some((i) => !i.value);
                                            });
                                        });
                                    }

                                    let timerId;
                                    let timeLeft = 60;
                                    function startTimer() {
                                        clearInterval(timerId);
                                        timeLeft = 60;
                                        timerEl.textContent = timeLeft;
                                        resendLink.classList.add('d-none');
                                        timerId = setInterval(() => {
                                            timeLeft--;
                                            timerEl.textContent = timeLeft;
                                            if (timeLeft <= 0) {
                                                clearInterval(timerId);
                                                resendLink.classList.remove('d-none');
                                            }
                                        }, 1000);
                                    }

                                    resendLink.addEventListener('click', async (e) => {
                                        e.preventDefault();
                                        // TODO: Call API to resend code
                                        await new Promise((r) => setTimeout(r, 600));
                                        buildCodeInputs();
                                        startTimer();
                                    });

                                    editEmailBtn.addEventListener('click', () => toStep('email'));

                                    verifyCodeBtn.addEventListener('click', async () => {
                                        const code = $$('#codeInputs input').map((i) => i.value).join('');
                                        verifyCodeBtn.disabled = true;
                                        verifyCodeBtn.innerHTML = '<i class="fa-solid fa-spinner fa-spin me-2"></i>Verifying...';

                                        // TODO: Replace with your API call to verify the code
                                        await new Promise((r) => setTimeout(r, 1000));

                                        if (code === '000000' || code.length !== 6) {
                                            // Simulate invalid
                                            verifyCodeBtn.innerHTML = '<i class="fa-solid fa-xmark me-2"></i> Invalid code';
                                            setTimeout(() => {
                                                verifyCodeBtn.innerHTML = '<i class="fa-solid fa-check-circle me-2"></i> Verify Code';
                                                verifyCodeBtn.disabled = false;
                                            }, 1200);
                                        } else {
                                            toStep('reset');
                                            clearInterval(timerId);
                                        }
                                    });

                                    // --- Step 3: reset password ---
                                    togglePass.addEventListener('click', () => {
                                        const isPwd = password.type === 'password';
                                        password.type = isPwd ? 'text' : 'password';
                                        confirmPw.type = isPwd ? 'text' : 'password';
                                        togglePass.innerHTML = isPwd ? '<i class="fa-regular fa-eye-slash"></i>' : '<i class="fa-regular fa-eye"></i>';
                                    });

                                    function zxcvbnLite(pw) {
                                        // Simple heuristic (replace with zxcvbn in production)
                                        let score = 0;
                                        if (pw.length >= 8)
                                            score++;
                                        if (/[A-Z]/.test(pw))
                                            score++;
                                        if (/[a-z]/.test(pw))
                                            score++;
                                        if (/[0-9]/.test(pw))
                                            score++;
                                        if (/[^A-Za-z0-9]/.test(pw))
                                            score++;
                                        return Math.min(score, 4); // 0..4
                                    }

                                    function updateStrength() {
                                        const pw = password.value;
                                        const score = zxcvbnLite(pw);
                                        const pct = [0, 25, 45, 70, 100][score];
                                        strengthBar.style.width = pct + '%';
                                        strengthMeter.classList.remove('weak', 'fair', 'good', 'strong');
                                        const labels = ['Too weak', 'Weak', 'Fair', 'Good', 'Strong'];
                                        strengthText.textContent = pw ? labels[score] : 'Use 8+ chars with letters, numbers & symbols.';
                                        strengthMeter.classList.add(['weak', 'weak', 'fair', 'good', 'strong'][score]);
                                    }

                                    function validateMatch() {
                                        const match = password.value && confirmPw.value && password.value === confirmPw.value;
                                        matchError.classList.toggle('d-none', match || !confirmPw.value);
                                        return match;
                                    }

                                    password.addEventListener('input', () => {
                                        updateStrength();
                                        resetBtn.disabled = !(validateMatch() && password.value.length >= 8);
                                    });
                                    confirmPw.addEventListener('input', () => {
                                        resetBtn.disabled = !(validateMatch() && password.value.length >= 8);
                                    });

                                    resetBtn.addEventListener('click', async () => {
                                        if (resetBtn.disabled)
                                            return;
                                        resetBtn.disabled = true;
                                        resetBtn.innerHTML = '<i class="fa-solid fa-spinner fa-spin me-2"></i>Resetting...';

                                        // TODO: Replace with your API call to finalize password reset
                                        // Example payload: { email: emailPreview.textContent, code, newPassword: password.value }
                                        await new Promise((r) => setTimeout(r, 1200));

                                        resetBtn.innerHTML = '<i class="fa-solid fa-check me-2"></i> Password Reset';
                                        setTimeout(() => {
                                            window.location.href = 'sign-in.html';
                                        }, 1000);
                                    });
        </script>


    </body>
</html>